<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Proj 7a">
    <title>Proj 7a</title>
    
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/512/7-number.png">
    
    <link rel="apple-touch-startup-image" href="https://via.placeholder.com/1179x2556/000000/0A84FF?text=7a" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --apple-blue: #0A84FF; --apple-bg: #000000; --apple-card: #1C1C1E; }
        body { background-color: var(--apple-bg); color: white; font-family: -apple-system, sans-serif; padding-bottom: 120px; }
        .card { background-color: var(--apple-card); border-radius: 18px; padding: 18px; margin-bottom: 12px; border: 0.5px solid #2C2C2E; }
        .nav-bar { background: rgba(28, 28, 30, 0.96); backdrop-filter: blur(20px); position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-between; padding: 12px 10px 35px 10px; border-top: 0.5px solid #2C2C2E; z-index: 100; }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; color: #636366; transition: 0.3s; }
        .nav-btn.active { color: var(--apple-blue); }
        .nav-btn svg { width: 22px; height: 22px; margin-bottom: 4px; }
        .exp-bar { height: 8px; background: #2C2C2E; border-radius: 4px; overflow: hidden; }
        .exp-fill { height: 100%; background: linear-gradient(90deg, #0A84FF, #5E5CE6); transition: width 0.5s; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 13px; font-weight: 600; border: 2px solid transparent; transition: 0.2s; }
        .status-done { background: var(--apple-blue) !important; color: white !important; border-color: var(--apple-blue) !important; }
        .status-current { border-color: white !important; }
        .status-selected { border-color: #5E5CE6 !important; background: rgba(94, 92, 230, 0.1); }
        .ritual-btn { background: #1C1C1E; border-radius: 12px; padding: 12px; display: flex; align-items: center; gap: 12px; border: 0.5px solid #2C2C2E; width: 100%; margin-bottom: 8px; }
        .ritual-done { border-color: var(--apple-blue); background: rgba(10, 132, 255, 0.1); }
    </style>
</head>
<body>

    <div class="p-6 sticky top-0 bg-black/90 backdrop-blur-xl z-50 border-b border-white/5">
        <div class="flex justify-between items-center mb-2">
            <h1 class="text-2xl font-black italic tracking-tighter uppercase leading-none">LVL <span id="lvl-display">1</span></h1>
            <p class="text-sm font-mono font-bold text-blue-400 leading-none"><span id="exp-display">0</span> / <span id="next-lvl-display">200</span> XP</p>
        </div>
        <div class="exp-bar"><div id="exp-fill" class="exp-fill"></div></div>
    </div>

    <div id="app-content" class="px-4 pt-4"></div>

    <nav class="nav-bar">
        <button onclick="renderTraining()" id="btn-train" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 18h4V6H6v12zM14 18h4V6h-4v12zM2 12h4m12 0h4"/></svg>
            <span class="text-[9px] font-bold uppercase tracking-tighter">Training</span>
        </button>
        <button onclick="renderHome()" id="btn-home" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            <span class="text-[9px] font-bold uppercase tracking-tighter">Home</span>
        </button>
        <button onclick="renderDiet()" id="btn-diet" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"></path></svg>
            <span class="text-[9px] font-bold uppercase tracking-tighter">Diet</span>
        </button>
    </nav>

    <script>
        let rawData = localStorage.getItem('climbDataV8');
        let state = rawData ? JSON.parse(rawData) : {
            totalExp: 0, history: {}, ritualsHistory: {}, diet: [], recipes: [],
            climbingActivities: { volume: null, projet: null },
            selectedDate: new Date().toISOString().split('T')[0],
            currentViewDate: new Date()
        };
        state.currentViewDate = new Date(state.currentViewDate);
        const weekMissions = [
            { day: "Dimanche", focus: "Doigts", mission: "Mini Crux + Stretching" },
            { day: "Lundi", focus: "Volley", mission: "Match + Mobilité" },
            { day: "Mardi", focus: "Grimpe", mission: "Session Projet 7a/b" },
            { day: "Mercredi", focus: "Volley", mission: "Entraînement + Mini Crux" },
            { day: "Jeudi", focus: "Volley", mission: "Match + Isométrie" },
            { day: "Vendredi", focus: "Grimpe", mission: "Session Volume 6b/c" },
            { day: "Samedi", focus: "Récup", mission: "Stretching + Cuisine" }
        ];
        function getLevelData(exp) {
            let lvl = 1;
            while (exp >= Math.floor(200 * Math.pow(lvl, 1.5))) { exp -= Math.floor(200 * Math.pow(lvl, 1.5)); lvl++; }
            return { lvl, currentExp: exp, nextLvlExp: Math.floor(200 * Math.pow(lvl, 1.5)) };
        }
        function save() { localStorage.setItem('climbDataV8', JSON.stringify(state)); updateHeader(); }
        function updateHeader() {
            const d = getLevelData(state.totalExp);
            document.getElementById('lvl-display').innerText = d.lvl;
            document.getElementById('exp-display').innerText = d.currentExp;
            document.getElementById('next-lvl-display').innerText = d.nextLvlExp;
            document.getElementById('exp-fill').style.width = (d.currentExp / d.nextLvlExp * 100) + '%';
        }
        function renderHome() {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-home').classList.add('active');
            const todayStr = new Date().toISOString().split('T')[0];
            const monthNames = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];
            let html = `
                <div class="card bg-gradient-to-br from-blue-600/10 to-transparent border-blue-500/20">
                    <h2 class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-3">Planning</h2>
                    <div class="space-y-1 text-[10px]">
                        ${weekMissions.map(m => `<div class="flex justify-between border-b border-white/5 pb-1"><span class="w-10 font-bold text-white uppercase">${m.day.slice(0,3)}</span><span class="flex-1 italic text-gray-500 px-2">${m.focus}</span><span>${m.mission}</span></div>`).join('')}
                    </div>
                </div>
                <div class="card">
                    <div class="flex justify-between items-center mb-4"><button onclick="changeMonth(-1)" class="p-2">◀</button><h2 class="font-bold text-xs uppercase tracking-widest">${monthNames[state.currentViewDate.getMonth()]}</h2><button onclick="changeMonth(1)" class="p-2">▶</button></div>
                    <div class="calendar-grid">${generateCalendarHTML()}</div>
                </div>
                <div id="mission-zone" class="card border-l-4 border-blue-500 bg-blue-500/5">${renderMissionDetails(state.selectedDate)}</div>
                <h3 class="text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1 mb-3">Rituels (+10 XP)</h3>
                <div class="space-y-2 mb-8">
                    ${['Souplesse', '2L Eau', 'Dents', 'Dessin'].map((l, i) => {
                        const id = ['str','wat','tea','dra'][i];
                        const isDone = state.ritualsHistory[todayStr] && state.ritualsHistory[todayStr][id];
                        return `<button onclick="toggleRitual('${todayStr}', '${id}')" class="ritual-btn ${isDone ? 'ritual-done' : ''}">
                            <div class="w-2 h-2 rounded-full ${isDone?'bg-blue-500':'bg-gray-700'}"></div>
                            <span class="text-xs font-bold flex-1">${l}</span>
                            <span class="text-[9px] font-black opacity-40">${isDone ? '✓' : '+10'}</span>
                        </button>`;
                    }).join('')}
                </div>
                <div class="p-4 text-center"><button onclick="exportData()" class="text-[9px] text-gray-700 uppercase font-black border border-gray-900 px-6 py-2 rounded-full">Exporter Data</button></div>
            `;
            document.getElementById('app-content').innerHTML = html;
        }
        function generateCalendarHTML() {
            const d = state.currentViewDate;
            const firstDay = (new Date(d.getFullYear(), d.getMonth(), 1).getDay() + 6) % 7;
            const daysInMonth = new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();
            const todayStr = new Date().toISOString().split('T')[0];
            let html = "";
            for (let i = 0; i < firstDay; i++) html += `<div></div>`;
            for (let i = 1; i <= daysInMonth; i++) {
                const dateStr = `${d.getFullYear()}-${(d.getMonth() + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                const isSelected = dateStr === state.selectedDate;
                const isToday = dateStr === todayStr;
                const isDone = state.history[dateStr] === 'done';
                let classes = isDone ? 'status-done' : (isToday ? 'status-current' : '');
                if (isSelected && !isDone) classes += ' status-selected';
                html += `<div onclick="selectDay('${dateStr}')" class="day ${classes}">${i}</div>`;
            }
            return html;
        }
        function selectDay(d) { state.selectedDate = d; renderHome(); }
        function changeMonth(o) { state.currentViewDate.setMonth(state.currentViewDate.getMonth() + o); renderHome(); }
        function renderMissionDetails(dateStr) {
            const dayIdx = new Date(dateStr).getDay();
            const mission = weekMissions[dayIdx].mission;
            const isDone = state.history[dateStr] === 'done';
            const todayStr = new Date().toISOString().split('T')[0];
            return `
                <p class="text-[9px] text-blue-400 font-black mb-1 uppercase tracking-widest">${dateStr===todayStr?'Aujourd’hui':'Mission'}</p>
                <p class="text-base font-black mb-3">${mission}</p>
                ${isDone ? `<p class="text-blue-400 font-bold text-center text-sm">✓ RÉALISÉ</p>` : (dateStr===todayStr ? `<button onclick="validateMission('${dateStr}')" class="w-full bg-blue-600 py-3 rounded-xl font-black uppercase text-[10px]">Valider Séance</button>` : `<p class="text-gray-600 text-center italic text-[10px]">Consultation</p>`)}
            `;
        }
        function validateMission(d) {
            if (weekMissions[new Date(d).getDay()].mission.includes("Escalade")) {
                document.getElementById('mission-zone').innerHTML = `<div class="grid grid-cols-2 gap-2"><button onclick="complete('${d}', 'volume')" class="bg-green-700 py-3 rounded-xl font-black text-[9px] uppercase">Volume</button><button onclick="complete('${d}', 'projet')" class="bg-purple-700 py-3 rounded-xl font-black text-[9px] uppercase">Projet</button></div>`;
            } else { complete(d); }
        }
        function complete(d) { const data = getLevelData(state.totalExp); state.history[d] = 'done'; state.totalExp += (50 + (data.lvl * 10)); save(); renderHome(); }
        function toggleRitual(d, id) {
            if (!state.ritualsHistory[d]) state.ritualsHistory[d] = {};
            state.ritualsHistory[d][id] = !state.ritualsHistory[d][id];
            state.totalExp += state.ritualsHistory[d][id] ? 10 : -10;
            save(); renderHome();
        }
        function exportData() { navigator.clipboard.writeText(JSON.stringify(state)); alert("Copié !"); }

        function renderTraining() {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-train').classList.add('active');
            document.getElementById('app-content').innerHTML = `
                <div class="card border-l-4 border-blue-500"><h3 class="font-black text-blue-400 mb-2 uppercase text-[10px] tracking-widest">Mini Crux</h3><p class="text-[11px] text-gray-400"><b>No-Hang :</b> Tirage 7s à 90% d'effort. 5 séries. Repos 2'30.</p></div>
                <div class="card border-l-4 border-purple-500"><h3 class="font-black text-purple-400 mb-2 uppercase text-[10px] tracking-widest">Hangboard</h3><p class="text-[11px] text-gray-400"><b>Fin de séance :</b> 6 séries de 7s (réglette 20mm).</p></div>
                <div class="card border-l-4 border-orange-500"><h3 class="font-black text-orange-400 mb-2 uppercase text-[10px] tracking-widest">Volley</h3><p class="text-[11px] text-gray-400"><b>Prévention :</b> 15 Tibialis Raises pour la rotule.</p></div>
                <div class="card border-l-4 border-green-500"><h3 class="font-black text-green-400 mb-2 uppercase text-[10px] tracking-widest">Souplesse</h3><p class="text-[11px] text-gray-400"><b>Chaise :</b> 3x45s jambes à 90°. Calme la douleur.</p></div>`;
        }

        function renderDiet() {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-diet').classList.add('active');
            let total = state.diet.reduce((sum, item) => sum + parseFloat(item.price), 0);
            document.getElementById('app-content').innerHTML = `
                <div class="card bg-green-500/5 text-center"><p class="text-[10px] text-gray-500 font-black uppercase tracking-widest">Budget</p><p class="text-4xl font-black ${total < 50 ? 'text-green-400' : 'text-red-400'}">${total.toFixed(2)}€</p></div>
                <div class="card"><div class="flex gap-2 mb-4"><input id="in-n" type="text" placeholder="Aliment" class="bg-white/5 border border-white/10 p-3 rounded-xl flex-1 text-sm text-white"><input id="in-p" type="number" placeholder="€" class="bg-white/5 border border-white/10 p-3 rounded-xl w-20 text-sm text-white"><button onclick="addI()" class="bg-blue-600 px-5 rounded-xl font-bold">+</button></div><div class="space-y-2">${state.diet.map((item, i) => `<div class="flex justify-between items-center text-sm bg-black/40 p-3 rounded-xl"><span onclick="toggleI(${i})" class="${item.checked?'line-through text-gray-600':''}">${item.name} (${item.price}€)</span><button onclick="removeI(${i})" class="text-red-500 p-2">✕</button></div>`).join('')}</div></div>
                <div class="card"><h3 class="font-black mb-4 text-[10px] uppercase text-blue-400 tracking-widest">Recettes</h3><div class="flex flex-col gap-2 mb-6"><input id="rec-t" type="text" placeholder="Nom" class="bg-white/5 border border-white/10 p-3 rounded-xl text-sm font-bold text-white"><textarea id="rec-d" placeholder="Instructions..." class="bg-white/5 border border-white/10 p-3 rounded-xl text-sm h-20 text-white"></textarea><button onclick="addR()" class="bg-green-600 py-3 rounded-xl font-black uppercase text-[10px]">Ajouter</button></div>${state.recipes.map((r, i) => `<div class="border-b border-white/5 pb-2 mb-2"><div onclick="toggleRecipe(${i})" class="flex justify-between items-center"><h4 class="font-bold text-gray-100 text-xs">${r.title}</h4><span class="text-gray-600 text-[10px]">Voir</span></div><p id="recipe-body-${i}" class="hidden text-[10px] text-gray-500 mt-2 whitespace-pre-line">${r.desc}</p><button onclick="removeR(${i})" class="text-red-900 text-[8px] uppercase mt-1">Supprimer</button></div>`).join('')}</div>`;
        }
        function toggleRecipe(i) { const b = document.getElementById(`recipe-body-${i}`); b.classList.toggle('hidden'); }
        function addI() { const n = document.getElementById('in-n').value, p = document.getElementById('in-p').value; if(n && p) { state.diet.push({name: n, price: parseFloat(p), checked: false}); save(); renderDiet(); } }
        function toggleI(i) { state.diet[i].checked = !state.diet[i].checked; save(); renderDiet(); }
        function removeI(i) { state.diet.splice(i, 1); save(); renderDiet(); }
        function addR() { const t = document.getElementById('rec-t').value, d = document.getElementById('rec-d').value; if(t && d) { state.recipes.push({title: t, desc: d}); save(); renderDiet(); } }
        function removeR(i) { state.recipes.splice(i, 1); save(); renderDiet(); }

        updateHeader(); renderHome();
    </script>
</body>
</html>
